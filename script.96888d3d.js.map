{"version":3,"sources":["src/script.js"],"names":["I18nAnalyzer","src","root","_src","_root","_idValueMap","_objectList","_objectTree","_idsByValue","object","keyList","value","obj","i","length","undefined","parent","id","name","text","escapedText","path","split","initializer","properties","constructor","normalizedValue","replaceAll","push","setObject","t","prop","traverse","tsSourceFile","ts","createSourceFile","ScriptTarget","Latest","console","log","statements","stmt","declarationList","declarations","decl","dupCount","valueCount","Object","keys","idCount","reportList","key","ids","join","count","document","getElementById","innerText","listEl","$","forEach","liEl","appendTo","ulEl","onclick","analyzer","analyze","report"],"mappings":"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","file":"script.96888d3d.js","sourceRoot":"..","sourcesContent":["class I18nAnalyzer {\r\n  constructor(src, root) {\r\n    this._src = src;\r\n    this._root = root;\r\n\r\n    this._idValueMap = {};\r\n    this._objectList = [];\r\n    this._objectTree = {};\r\n    this._idsByValue = {};\r\n  }\r\n\r\n  setObject(object, keyList, value) {\r\n    let obj = object;\r\n    let i = 0;\r\n    for (; i < keyList.length - 1; i++) {\r\n      if (obj[keyList[i]] === undefined) {\r\n        obj[keyList[i]] = {};\r\n      }\r\n      obj = obj[keyList[i]];\r\n    }\r\n    obj[keyList[i]] = value;\r\n  }\r\n\r\n  traverse(object, parent) {\r\n    let name = object.name.text || object.name.escapedText;\r\n    let id = (parent ? parent + \".\" : \"\") + name;\r\n    let path = id.split(\".\");\r\n    let initializer = object.initializer;\r\n    let properties = object.initializer?.properties || [];\r\n    if (initializer.constructor.name === \"TokenObject\") {\r\n      let value = initializer.text;\r\n      let normalizedValue = value\r\n        .replaceAll(/\\s+|<br>|[.,]/gi, \"\")\r\n        .replaceAll(/\\{\\{.+\\}\\}/g, \"{{}}\");\r\n      // indexing data.\r\n      this._idValueMap[id] = { id, value, path };\r\n      this._objectList.push({ id, value, path, normalizedValue });\r\n      this.setObject(this._objectTree, path, value);\r\n      let t = this._idsByValue[normalizedValue] ?? [];\r\n      t.push(id);\r\n      this._idsByValue[normalizedValue] = t;\r\n    }\r\n    for (let prop of properties) {\r\n      this.traverse(prop, id);\r\n    }\r\n  }\r\n\r\n  analyze() {\r\n    /* const source = fs.readFileSync(this._path, 'utf8') */\r\n    const tsSourceFile = ts.createSourceFile(\r\n      \"tmp\",\r\n      this._src,\r\n      ts.ScriptTarget.Latest\r\n    );\r\n\r\n    console.log(tsSourceFile);\r\n    for (let stmt of tsSourceFile.statements) {\r\n      for (let decl of stmt.declarationList.declarations) {\r\n        this.traverse(decl);\r\n      }\r\n    }\r\n  }\r\n\r\n  report() {\r\n    let dupCount = 0;\r\n    let valueCount = Object.keys(this._idsByValue).length;\r\n    let idCount = this._objectList.length;\r\n\r\n    let reportList = [];\r\n\r\n    console.log(\"\\n--- 중복된 항목\");\r\n    for (let key of Object.keys(this._idsByValue)) {\r\n      if (this._idsByValue[key].length > 1) {\r\n        let ids = this._idsByValue[key];\r\n        console.log(`${key} (${ids.length})`);\r\n        console.log(` - ${ids.join(\"\\n - \")}`);\r\n        reportList.push({ text: key, count: ids.length, ids: ids });\r\n        dupCount++;\r\n      }\r\n    }\r\n\r\n    document.getElementById(\r\n      \"summary\"\r\n    ).innerText = `중복됨 : ${dupCount}\\n단어 수: ${valueCount}\\n전체 항목 수: ${idCount}\\n`;\r\n    //fs.writeFileSync(\"result.json\", JSON.stringify(reportList, null, 2))\r\n\r\n    let listEl = $(\"ul#result\");\r\n    reportList.forEach((obj) => {\r\n      let liEl = $(\"<li>\").text(`${obj.text} (${obj.count})`).appendTo(listEl);\r\n      let ulEl = $(\"<ul>\").appendTo(liEl);\r\n      obj.ids?.forEach((id) => {\r\n        $(\"<li>\").text(id).appendTo(ulEl);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\ndocument.getElementById(\"run-btn\").onclick = () => {\r\n  console.log(1);\r\n  let src = document.getElementById(\"run-target\");\r\n  let analyzer = new I18nAnalyzer(src.value, \"i18nKorean\");\r\n  analyzer.analyze();\r\n  analyzer.report();\r\n};\r\n"]}